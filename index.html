<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>YUGY.ORG - ë„ë©´ ì†Œìƒìˆ  ê²Œì„</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Malgun Gothic', sans-serif; }
        #ui-container {
            position: absolute; top: 10px; left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px; border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 300px;
        }
        textarea { width: 100%; height: 100px; margin-bottom: 10px; }
        button {
            width: 100%; padding: 10px; background: #007bff; color: white;
            border: none; border-radius: 4px; cursor: pointer; font-weight: bold;
        }
        button:hover { background: #0056b3; }
        #info { margin-top: 10px; font-size: 12px; color: #555; }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <div id="ui-container">
        <h3>ğŸ  ë„ë©´ ì†Œìƒìˆ  ì‹œë®¬ë ˆì´í„°</h3>
        <p>ì—‘ì…€ ë°ì´í„°ë¥¼ ì•„ë˜ì— ë¶™ì—¬ë„£ê³  ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
        <textarea id="dataInput" placeholder="ì˜ˆ: ë²½, 200, 20, #FF5733"></textarea>
        <button id="buildBtn">ë„ë©´ ìƒì„±í•˜ê¸° (Build)</button>
        <div id="info">ë§ˆìš°ìŠ¤ ì™¼ìª½: íšŒì „ / ì˜¤ë¥¸ìª½: ì´ë™ / íœ : ì¤Œ<br><b>Shift + ë“œë˜ê·¸: ë¬¼ì²´ ì´ë™ (ê²Œì„ëª¨ë“œ)</b></div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { DragControls } from 'three/addons/controls/DragControls.js';

        // 1. ê¸°ë³¸ 3D ë¬´ëŒ€ ì„¸íŒ…
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0); // ë°°ê²½ìƒ‰ (ë°ì€ íšŒìƒ‰)

        // ì¹´ë©”ë¼ ì„¤ì •
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 50, 50); // ìœ„ì—ì„œ ì•„ë˜ë¡œ ë‚´ë ¤ë‹¤ë³´ëŠ” ë·°
        camera.lookAt(0, 0, 0);

        // ë Œë”ëŸ¬ ì„¤ì •
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // ì¡°ëª… ì„¤ì •
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(50, 80, 50);
        dirLight.castShadow = true;
        scene.add(dirLight);

        // ë°”ë‹¥ ê·¸ë¦¬ë“œ (ê±´ì¶•ì‚¬ ëˆˆê¸ˆ)
        const gridHelper = new THREE.GridHelper(100, 100);
        scene.add(gridHelper);

        // ë§ˆìš°ìŠ¤ ì»¨íŠ¸ë¡¤ (í™”ë©´ ëŒë¦¬ê¸°)
        const controls = new OrbitControls(camera, renderer.domElement);
        
        // ë¬¼ì²´ë“¤ì´ ë‹´ê¸¸ ë¦¬ìŠ¤íŠ¸
        let objects = [];
        let dragControls;

        // 2. ì—‘ì…€ ë°ì´í„° í•´ì„ ë° ìƒì„± í•¨ìˆ˜
        function buildFromData() {
            // ê¸°ì¡´ ë¬¼ì²´ ì‚­ì œ
            objects.forEach(obj => scene.remove(obj));
            objects = [];

            const input = document.getElementById('dataInput').value;
            const lines = input.split('\n'); // ì—”í„°í‚¤ë¡œ ì¤„ ë‚˜ëˆ„ê¸°

            lines.forEach(line => {
                // ë°ì´í„° í¬ë§·: ì¢…ë¥˜, ê°€ë¡œ, ì„¸ë¡œ(ë†’ì´), ìƒ‰ìƒ
                // ì˜ˆ: ë²½, 10, 5, #FF0000
                let parts = line.split(',');
                if(parts.length < 2) return;

                let type = parts[0].trim();
                let width = parseFloat(parts[1]);
                let height = parseFloat(parts[2]); // ë²½ì´ë©´ ë†’ì´, ë°”ë‹¥ì´ë©´ ê¹Šì´
                let color = parts[3] ? parts[3].trim() : '#cccccc';

                let geometry, material, mesh;

                if (type === 'ë²½') {
                    // ë²½ì€ ìœ„ë¡œ ì†Ÿì•„ì˜¤ë¦„ (BoxGeometry)
                    geometry = new THREE.BoxGeometry(width, 10, 2); // ë†’ì´ëŠ” 10ìœ¼ë¡œ ê³ ì •, ë‘ê»˜ 2
                    material = new THREE.MeshStandardMaterial({ color: color });
                    mesh = new THREE.Mesh(geometry, material);
                    mesh.position.y = 5; // ë°”ë‹¥ ìœ„ì— ì˜¬ë¼ì˜¤ê²Œ
                } else if (type === 'ë°”ë‹¥') {
                    // ë°”ë‹¥ì€ í‰í‰í•¨ (PlaneGeometry)
                    geometry = new THREE.PlaneGeometry(width, height);
                    material = new THREE.MeshStandardMaterial({ color: color, side: THREE.DoubleSide });
                    mesh = new THREE.Mesh(geometry, material);
                    mesh.rotation.x = -Math.PI / 2; // ëˆ•íˆê¸°
                    mesh.position.y = 0.1; // ê·¸ë¦¬ë“œë³´ë‹¤ ì‚´ì§ ìœ„ì—
                }

                if (mesh) {
                    mesh.castShadow = true;
                    mesh.receiveShadow = true;
                    scene.add(mesh);
                    objects.push(mesh);
                }
            });

            // ë“œë˜ê·¸ ê¸°ëŠ¥ ë‹¤ì‹œ ì—°ê²°
            if(dragControls) dragControls.dispose();
            dragControls = new DragControls(objects, camera, renderer.domElement);
            
            // ë“œë˜ê·¸í•  ë•Œ í™”ë©´ íšŒì „ ë©ˆì¶”ê¸° (ì¶©ëŒ ë°©ì§€)
            dragControls.addEventListener('dragstart', function () { controls.enabled = false; });
            dragControls.addEventListener('dragend', function () { controls.enabled = true; });
        }

        // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
        document.getElementById('buildBtn').addEventListener('click', buildFromData);

        // 3. ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„ (ê³„ì† ê·¸ë¦¬ê¸°)
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        animate();

        // ì°½ í¬ê¸° ì¡°ì ˆ ëŒ€ì‘
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>